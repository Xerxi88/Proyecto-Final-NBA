const arrayShirts=[
  {
   "id": 1,
   "img":"/img/shirts/atlanta-hawks-nike-association-edition-swingman-jersey-white-bogdan-bogdanovic-unisex_ss4_p-13348819+u-prtb3f5px0o2qm6ho13n+v-b9fd69cbd31c436ba90dded5831c3c68.jpg",
   "name": "Bodgan Bogdanovic",
   "number":"13",
   "price" : 29.99,
   "discount" : false,
   "category" : "atalanta"
  },
  {
   "id": 2,
   "img":"/img/shirts/atlanta-hawks-nike-association-edition-swingman-jersey-white-clint-capela-unisex_ss4_p-13348811+u-zm6kd6o3g56g2w1isl2f+v-9994083f2dc74df29a7c3f78f1b4f90d.jpg",
   "name":"Clint Capella",
   "number":"15",
   "price" : 29.99,
   "discount" : false,
   "category" : "atalanta"
  },
  {
   "id": 3,
   "img":"/img/shirts/atlanta-hawks-nike-association-edition-swingman-jersey-white-trae-young-unisex_ss4_p-13348853+u-5fugb90qyoly7ehvp89e+v-205feabbc7d54cd5b9cd5317a2693480.jpg",
   "name":"Trae Young",
   "number":"11",
   "price" : 29.99,
   "discount" : false,
   "category" : "atalanta"
  },
  {
     "id": 4,
     "img":"/img/shirts/boston-celtics-nike-classic-edition-swingman-jersey-white-jayson-tatum-mens_ss4_p-12096199+u-1dqs58wxt1wvjmoj4gwc+v-7de69cc13d494facbc3252fda26b3dd7.jpg",
     "name":"Jayson Tatum",
     "number":"0",
     "price" : 29.99,
     "discount" : true,
     "category" : "boston"
    },
    {
     "id": 5,
     "img":"/img/shirts/boston-celtics-nike-classic-edition-swingman-jersey-white-marcus-smart-mens_ss4_p-12096187+u-161ah6o1ku0b4ks9oie1+v-ee9b6ea4f794412584f60a2fb757f61e.jpg",
     "name":"Marcus Smart",
     "number":"36",
     "price" : 29.99,
     "discount" : true,
     "category" : "boston"
    },
    {
     "id": 6,
     "img":"/img/shirts/boston-celtics-nike-classic-edition-swingman-jersey-white-payton-pritchard-mens_ss4_p-12096184+u-gf0rs4szb9bqpwn0oogz+v-57cd11b91b9d4c398085fc390f35ae0e.jpg",
     "name":"Payton Pitchard",
     "number":"11",
     "price" : 29.99,
     "discount" : false,
     "category" : "boston"
    },
    {
     "id": 7,
     "img":"/img/shirts/chicago-bulls-nike-icon-edition-swingman-jersey-red-demar-derozan-unisex_ss4_p-13349377+u-ro1aji9w0wgeusih81d1+v-09e3419ca66d477bbbb0966392428765.jpg",
     "name":"DeMar DeRozan",
     "number":"11",
     "price" : 29.99,
     "discount" : true,
     "category" : "chicago"
    },
    {
     "id": 8,
     "img":"/img/shirts/chicago-bulls-nike-icon-swingman-jersey-lonzo-ball-unisex_ss4_p-13367973+u-6dcvumvqi1a5h79338h8+v-43c6505d0905485099c2c931c6140f0a.jpg",
     "name":"Lonzo Ball",
     "number":"2",
     "price" : 29.99,
     "discount" : false,
     "category" : "chicago"
    },
    {
     "id": 9,
     "img":"/img/shirts/chicago-bulls-nike-icon-swingman-jersey-zach-lavine-unisex_ss4_p-13372736+u-tew2xpacui5yx9yrkrm3+v-df9fb21432fd4f3cb1e751156a178a53.jpg",
     "name":"Nikola Vucevic",
     "number":"9",
     "price" : 29.99,
     "discount" : false,
     "category" : "chicago"
    },
    {
     "id": 10,
     "img":"/img/shirts/golden-state-warriors-nike-icon-edition-swingman-jersey-royal-draymond-green-unisex_ss4_p-13349314+u-88uow63tvlg8i131zujf+v-8effc49af534478582b7865e3aa0d6dd.jpg",
     "name":"Draymond Green",
     "number":"23",
     "price" : 29.99,
     "discount" : true,
     "category" : "goldenState"
    },
    {
     "id": 11,
     "img":"/img/shirts/golden-state-warriors-nike-icon-edition-swingman-jersey-royal-klay-thompson-unisex_ss4_p-13349336+u-quumrrsmgmgice638kc9+v-b5359128c08d4b19823f53a3224e3036.jpg",
     "name":"Klay Thompson",
     "number":"11",
     "price" : 29.99,
     "discount" : false,
     "category" : "goldenState"
    },
    {
     "id": 12,
     "img":"/img/shirts/golden-state-warriors-nike-icon-edition-swingman-jersey-royal-stephen-curry-unisex_ss4_p-13349705+u-99p4oaahgsihm35bjg9r+v-c17f5924d5604352893dcbad25ba3d65.jpg",
     "name":"Stephen Curry",
     "number":"30",
     "price" : 29.99,
     "discount" : true,
     "category" : "goldenState"
    },
    {
     "id": 13,
     "img":"/img/shirts/los-angeles-lakers-nike-icon-edition-swingman-jersey-gold-anthony-davis-unisex_ss4_p-13348385+u-z2yjasf2vnogq2c9lz2t+v-f4a2cab452264103a0971086af3cba7f.jpg",
     "name":"Anthony Davis",
     "number":"3",
     "price" : 29.99,
     "discount" : false,
     "category" : "lakers"
    },
    {
     "id": 14,
     "img":"/img/shirts/los-angeles-lakers-nike-icon-edition-swingman-jersey-gold-lebron-james-unisex_ss4_p-13348378+u-fp3otbq191kx828hrd1i+v-5a9c2d0539404bff8535dc183e58a4f2.jpg",
     "name":"Lebron James",
     "number":"6",
     "price" : 29.99,
     "discount" : false,
     "category" : "lakers"
    },
    {
     "id": 15,
     "img":"/img/shirts/los-angeles-lakers-nike-icon-edition-swingman-jersey-gold-russell-westbrook-youth_ss4_p-13348411+u-1bzijyh7oa0oaatyl3cv+v-9dedde1bbcab4883a69355b9324dddca.jpg",
     "name":"Russell Westbrook",
     "number":"0",
     "price" : 29.99,
     "discount" : false,
     "category" : "lakers"
    },
    {
     "id": 16,
     "img":"/img/shirts/milwaukee-bucks-nike-icon-edition-swingman-jersey-green-giannis-antetokounmpo-unisex_ss4_p-13349398+u-f7s1p5esdr45cc71ei2w+v-81dfe3351d6449a3a6aeaf73231564fc.jpg",
     "name":"Giannis Antetokoumpo",
     "number":"34",
     "price" : 29.99,
     "discount" : true,
     "category" : "milwaukee"
    },
    {
     "id": 17,
     "img":"/img/shirts/milwaukee-bucks-nike-icon-edition-swingman-jersey-green-jrue-holiday-unisex_ss4_p-13349419+u-i7yugctsr0gcre17q76x+v-e9f644b264864982a0a7faaae7d20eb4.jpg",
     "name":"Jrue Holiday",
     "number":"21",
     "price" : 29.99,
     "discount" : false,
     "category" : "milwaukee"
    },
    {
     "id": 18,
     "img":"/img/shirts/milwaukee-bucks-nike-icon-edition-swingman-jersey-green-khris-middleton-unisex_ss4_p-13349424+u-geufb5oa2ntvurjvq478+v-6d5c7ff9e59c47c180e753643a832714.jpg",
     "name":"Khris Middleton",
     "number":"22",
     "price" : 29.99,
     "discount" : true,
     "category" : "milwaukee"
    },
    {
     "id": 19,
     "img":"/img/shirts/philadelphia-76ers-nike-icon-edition-swingman-jersey-royal-james-harden-youth_ss4_p-13315424+u-1056sn9nf30eco4nlq3d+v-f79d82ccbd1b46bdbff83034e2d7ff94.jpg",
     "name":"James Harden",
     "number":"1",
     "price" : 29.99,
     "discount" : false,
     "category" : "philadelpia"
    },
    {
     "id": 20,
     "img":"/img/shirts/philadelphia-76ers-nike-icon-edition-swingman-jersey-royal-joel-embiid-unisex_ss4_p-13349382+u-1d2ejg7lskxebykj2eh5+v-be568402bc2e49c78ceacfffca7f1c3e.jpg",
     "name":"Joel Embiid",
     "number":"21",
     "price" : 29.99,
     "discount" : false,
     "category" : "philadelpia"
    },
    {
     "id": 21,
     "img":"/img/shirts/philadelphia-76ers-nike-icon-swingman-jersey-ben-simmons-mens_ss4_p-12045407+u-uag1gj7f19ptkkr6cwac+v-bbf08df50da34459bba0ea4b4e081c6e.jpg",
     "name":"Ben Simons",
     "number":"25",
     "price" : 29.99,
     "discount" : true,
     "category" : "philadelpia"
    },
    {
     "id": 22,
     "img":"/img/shirts/toronto-raptors-nike-city-edition-swingman-jersey-og-anunoby-mens_ss4_p-13300347+u-cnqvly2d8kwscwawmq3u+v-c321f33e622a4d21affa682d1476c227.jpg",
     "name":"OG Anunoby",
     "number":"3",
     "price" : 29.99,
     "discount" : false,
     "category" : "toronto"
    },
    {
     "id": 23,
     "img":"/img/shirts/toronto-raptors-nike-city-edition-swingman-jersey-pascal-siakam-mens_ss4_p-13300287+u-w7lw2aps37ri9aox0u2y+v-2462ce6046954ea7a1b2d6fcd20cb231.jpg",
     "name":"Pascal Siakam",
     "number":"43",
     "price" : 29.99,
     "discount" : true,
     "category" : "toronto"
    },
    {
     "id": 24,
     "img":"/img/shirts/toronto-raptors-nike-city-edition-swingman-jersey-scottie-barnes-mens_ss4_p-13300322+u-qb6qzbgsaz1in5syszla+v-c25117a300d94098a6aa390be9b2b807.jpg",
     "name":"Scottie Barnes",
     "number":"4",
     "price" : 29.99,
     "discount" : false,
     "category" : "toronto"
    },
    {
     "id": 25,
     "img":"/img/shirts/legend-boston-celtics-75th-anniversary-swingman-jersey-larry-bird-youth-by-mitchell-and-ness_ss4_p-12070935+u-9yya8q32dg7nifir9obi+v-c70f4f7ce75746da8f4ffeee0086dd15.jpg",
     "name":"Larry Bird",
     "number":"33",
     "price" : 49.99,
     "discount" : false,
     "category" : "legends"
    },
    {
     "id": 26,
     "img":"/img/shirts/legend-hardwood-classics-premium-gold-jersey_pi3381000_altimages_ff_3381450-524fb0c3bd842bd3f530alt1_full.jpg",
     "name":"Michael Jordan",
     "number":"23",
     "price" : 49.99,
     "discount" : true,
     "category" : "legends"
    },
    {
     "id": 27,
     "img":"/img/shirts/legend-los-angeles-lakers-kobe-bryant-2009-authentic.jpg",
     "name":"Kobe Bryant",
     "number":"24",
     "price" : 49.99,
     "discount" : true,
     "category" : "legends"
    },
    {
     "id": 28,
     "img":"/img/shirts/-legend-mens-mitchell-and-ness-allen-iverson-black-philadelphia-76ers-big-and-tall-hardwood-classics-jersey_pi3278000_altimages_ff_3278325-ecbfe67f8307cea60cb5alt1_full.jpg",
     "name":"Allen Iverson",
     "number":"3",
     "price" : 49.99,
     "discount" : false,
     "category" : "legends"
    },
    {
     "id": 29,
     "img":"/img/shirts/legend-vince-carter-1998-hardwood-classics-home-swingman-jersey-by-mitchell-and-ness-white-mens_ss4_p-11900455+u-1alq10lhlitgiqeed1x2+v-2433299f9b854997b1f45a3e030433a0.jpg",
     "name":"Vince Carter",
     "number":"15",
     "price" : 49.99,
     "discount" : true,
     "category" : "legends"
    },
    {
     "id": 30,
     "img":"/img/shirts/legennd-mens-mitchell-and-ness-steve-nash-white-phoenix-suns-1996-1997-authentic-hardwood-classics-swingman-jersey_pi4247000_altimages_ff_4247087-ade3dcbd6f7118343a55alt1_full.jpg",
     "name":"Steve Nash",
     "number":"13",
     "price" : 49.99,
     "discount" : false,
     "category" : "legends"
    },
]
 
 
 
   
   
 const fetchData = async () =>{
    try{
        const respuesta = await fetch(`catalog.json`);
        const data = await respuesta.json();


        for(const item of data){

           printShirt(item);

        }    
       
    }catch{}
}

fetchData();


const printShirt = (item)=>{
    
    const shirt = document.querySelector(`#${item.category} .shirts`);
    const template = document.querySelector("#template-shirt").content;
    const clone = template.cloneNode(true);
    const fragment = document.createDocumentFragment();

    clone.querySelector(".card-img-top").setAttribute('src', item.img);
    clone.querySelector(".number").innerText=`#${item.number}`;
    clone.querySelector(".name").innerText=item.name;
    clone.querySelector(".price").innerText=`${item.price} €`;
    if(item.discount){
      clone.querySelector(".offer").insertAdjacentHTML('beforeend',`<div class=animation>Offer 20%</div>`)
    }

    fragment.appendChild(clone);
    shirt.appendChild(fragment);

}

window.addEventListener('load',()=>{

    const buttons = document.querySelectorAll(".boton");
    buttons.forEach((button, index) => {
        button.setAttribute("data-id", index + 1);
      });
      document.addEventListener("click", (e) => {
        if (e.target.tagName === "BUTTON") {
          buy(e.target.dataset.id);
        }
      });
})
 
 let cartList = JSON.parse(localStorage.getItem("cartList"))||[];

 let cart = JSON.parse(localStorage.getItem("cart"))||[];
 
 let total = 0;
 
 function buy(id) {

        let buscar=arrayShirts.find(shirt=>shirt.id==id)
         cartList.push(buscar);
         generateCart(buscar);
         calculateTotal(); 
         printCart(); 
         localStorage.setItem("cartList", JSON.stringify(cartList)); 
      }
 
 function cleanCart() {
     cartList=[];
     cart=[];
     document.getElementById("count_product").innerHTML=0;
     total=0;
     document.querySelector(".list").innerHTML = ``;
     printCart();
     document.querySelector(".titulo").innerHTML = "Your cart is empty";
     localStorage.removeItem("cart");
     localStorage.removeItem("cartList");
     localStorage.removeItem("cartLegth");
 }
 function calculateTotal() {
     total=0;
     for(objeto of cart){
       if (objeto.subtotalWithDiscount == undefined) {
         total += objeto.price*objeto.quantity;
       } else {
         total += objeto.subtotalWithDiscount;
       }}
 }
 function generateCart(producto) {
     let comp=cart.some(a=>a.id == producto.id);
     if(!comp){
        cart.push(producto);
        producto.quantity=1;
     }else{
        producto.quantity++; 
     }
    localStorage.setItem("cart", JSON.stringify(cart));  
     
     applyPromotionsCart(producto);
 }

 function applyPromotionsCart(producto) {
  if(producto.discount){
         producto.subtotalWithDiscount = producto.price*0.8*producto.quantity;
  }
 }
 
 function printCart() {
     const cartLegth = cartList.length;
     localStorage.setItem("cartLegth",JSON.stringify(cartLegth));
     document.getElementById("count_product").innerHTML = JSON.parse(localStorage.getItem("cartLegth"));
     document.querySelector(".titulo").textContent = "Shopping cart";
     document.querySelector(".list").innerHTML = `<table class="table mt-3 me-3">
                                                  <thead>
                                                    <tr>
                                                      <th scope="col">Products</th>
                                                      <th scope="col">Price</th>
                                                      <th scope="col">Qty.</th>
                                                      <th scope="col">Offer</th>
                                                      <th scope="col">Total</th>
                                                      <th scope="col"></th>
                                                    </tr>
                                                  </thead>
                                                  <tbody>
                                                  </tbody>
                                                </table>
                                                <div class="text-center fs-2">Total:${total.toFixed(2)}€</div>`;
     for (objeto of cart) {
      console.log(objeto);
       if (objeto.subtotalWithDiscount == undefined) {
         document.querySelector("tbody").insertAdjacentHTML("beforeend", 
             `<tr>
                 <td>${objeto.name}</td>
                 <td>${objeto.price}€</td>
                 <td>${objeto.quantity}</td>
                 <td>${objeto.discount ? "20%" : ""}</td>
                 <td>${objeto.price*objeto.quantity}€</td>
                 <td><div class="btn btn-danger" onclick=removeFromCart(${objeto.id})>-</div></td>
             <tr>`)
       } else {
         document.querySelector("tbody").insertAdjacentHTML("beforeend", 
             `<tr>
               <td>${objeto.name}</td>
               <td>${objeto.price}€</td>
               <td>${objeto.quantity}</td>
               <td>${objeto.discount ? "20%" : ""}</td>
               <td>${objeto.subtotalWithDiscount.toFixed(2)}€</td>
               <td><div class="btn btn-danger restar" onclick=removeFromCart(${objeto.id})>-</div></td>
             <tr>`)
       }
     }
 }
 printCart();

 function removeFromCart(id) {
    
     let transf=cartList.find(products=>products.id==id)
     const buscar=cartList.indexOf(transf);
     cartList.splice(buscar,1);
     transf.quantity-=1;
     if(transf.subtotalWithDiscount){
     transf.subtotalWithDiscount=transf.quantity*transf.price*0.8;}
     if(transf.quantity==0){
         const findCart=cart.indexOf(transf);
         cart.splice(findCart,1);
     }
     calculateTotal();
     localStorage.setItem("cartList", JSON.stringify(cartList)); 
     localStorage.setItem("cart", JSON.stringify(cart));
     printCart();
       
 }
 
 function open_modal(){
     printCart();
 }

 